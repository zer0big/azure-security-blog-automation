{
    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "$connections": {
            "defaultValue": {},
            "type": "Object"
        },
        "openAiEndpoint": {
            "type": "String",
            "metadata": {
                "description": "Azure OpenAI API Endpoint (예: https://your-openai.openai.azure.com/)"
            }
        },
        "openAiDeploymentName": {
            "type": "String",
            "defaultValue": "gpt-4",
            "metadata": {
                "description": "Azure OpenAI GPT-4 Deployment Name"
            }
        },
        "emailRecipient": {
            "type": "String",
            "metadata": {
                "description": "이메일 수신자 주소"
            }
        },
        "rssFeedUrl": {
            "type": "String",
            "defaultValue": "https://www.microsoft.com/en-us/security/blog/feed/",
            "metadata": {
                "description": "RSS 피드 URL"
            }
        }
    },
    "triggers": {
        "Recurrence": {
            "recurrence": {
                "frequency": "Day",
                "interval": 1,
                "schedule": {
                    "hours": [
                        "9"
                    ],
                    "minutes": [
                        0
                    ]
                },
                "timeZone": "Korea Standard Time"
            },
            "type": "Recurrence"
        }
    },
    "actions": {
        "List_RSS": {
            "inputs": {
                "host": {
                    "connection": {
                        "referenceName": "rss"
                    }
                },
                "path": "/ListFeedItems",
                "queries": {
                    "feedUrl": "@parameters('rssFeedUrl')"
                },
                "method": "get"
            },
            "runAfter": {},
            "type": "ApiConnection"
        },
        "Send_Test_Email": {
            "inputs": {
                "body": {
                    "Subject": "✅ Logic App 테스트 - @{utcNow()}",
                    "To": "@parameters('emailRecipient')",
                    "Body": "<h2>Logic App 동작 확인 테스트</h2><p><strong>이메일 발송 성공!</strong></p><p>수신자: @{parameters('emailRecipient')}</p><p>시간: @{utcNow()}</p><hr/><p>RSS 피드 조회 완료. 이 이메일이 도착했다면 전체 시스템이 정상 작동 중입니다.</p>",
                    "Importance": "High"
                },
                "host": {
                    "connection": {
                        "referenceName": "office365"
                    }
                },
                "path": "/v2/Mail",
                "method": "post"
            },
            "runAfter": {
                "List_RSS": [
                    "Succeeded"
                ]
            },
            "type": "ApiConnection"
        }
    },
    "outputs": {}
}
